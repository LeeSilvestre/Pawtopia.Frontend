<template>
    <div class="admin-container">
      <div class="d-flex justify-content-between">
        <h1>CulinaryNex Admin - Manage Menu</h1>
        <button class="btn" @click="addNewFood">Add</button>
        <button class="btn" @click="goToDashboard">Back to Dashboard</button>
      </div>
  
      <div class="table-responsive">
            <!-- PROJECT TABLE -->
            <table class="table colored-header datatable project-list">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Discount</th>
                        <th>Description</th>
                        <th>Type</th>
                        <th>Category</th>
                        <th>Image</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="item in menuData" :key="item.id">
                        <td>{{ item.food_id }}</td>
                        <td>{{ item.food_name }}</td>
                        <td>{{ item.food_price }}</td>
                        <td>{{ item.food_discount }}</td>
                        <td>{{ item.food_desc }}</td>
                        <td>{{ item.food_type }}</td>
                        <td>{{ item.food_category }}</td>
                        <td>{{ item.food_src }}</td>
                        <td>
                            <!--<button class="paid-btn" @click="updateMenu(item)">Update</button>-->
                            <button class="cancel-btn" @click="confirmDelete(item.food_id)">Delete</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</template>

<script>
import axios from 'axios';

export default {
    name: 'ManageMenu',

    data() {
        return {
            menuData: [],
            selectedItem: null,
        };
    },

    created() {
        this.fetchMenuData();
    },

    methods: {

        addNewFood() {
            this.$router.push('/admin/addnewfood');
        },

        goToDashboard() {
            this.$router.push('/admin/dashboard');
        },

        updateMenu(item) {
            this.$router.push({ name: 'UpdateMenu', params: { id: item.food_id } });
        },

        confirmDelete(foodId) {
            this.selectedItem = this.menuData.find(item => item.food_id === foodId);

            if (confirm(`Are you sure you want to delete "${this.selectedItem.food_name}"?`)) {
                this.deleteMenu();
            }
        },

        async deleteMenu() {
            if (!this.selectedItem) {
                console.error('No item selected for deletion.');
                return;
            }

            try {
                await axios.delete(`/foods/${this.selectedItem.food_id}`);
                console.log(`Menu item "${this.selectedItem.food_name}" deleted successfully.`);
                this.fetchMenuData();
            } catch (error) {
                console.error('Error deleting menu item:', error);
            }

            this.selectedItem = null;
        },

        async fetchMenuData() {
            try {
                const response = await axios.get('/foods');
                console.log('Menu data:', response.data);
                this.menuData = response.data;
            } catch (error) {
                console.error('Error fetching menu data:', error);
            }
        },
    },
};
</script>

<style scoped>

.admin-container {
    background-color: #DAE3F3;
    height: auto;
    padding: 2rem 9%; 
    font-size: 16px;
}

.project-list>tbody>tr>td {
    color: black;
    padding: 12px 8px;
}

.project-list>tbody>tr>td .avatar {
    width: 22px;
    border: 1px solid #CCC;
}

.colored-header thead {
    background-color: #27ae60; 
    color: white; 
}

.table-responsive {
    margin-top: 8vh;
}

.action-btn,
.cancel-btn,
.paid-btn {
    width: 100px;
    height: 25px;
    color: white;
    text-transform: capitalize;
}

.action-btn {
    background-color: #0da9ef;
    margin-right: 10px;
}

.cancel-btn{
    background-color: red;
}
.paid-btn {
    background-color: #27ae60;
}

.action-btn:hover {
    background-color: #27ae60;
}
</style>